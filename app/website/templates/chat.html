{% extends 'base.html' %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Chat with {{ receiver.username }}</title>
    <style>
        body {
            justify-content: center;
            align-items: center;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to left, rgb(80, 12, 80), rgb(90, 22, 83), rgb(28, 12, 90));
            margin: 0;
            padding: 0;
            border-radius: 10px;
        }

        .row {
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
        }
        #btn1{
            padding: 10px;
            background-color: #FA9189;
            border: none;
            border-radius: 5px;
            color: #b9382f;
        }
        #btn1:hover{
            background-color: #d17b75;
        }
        #btn2{
            padding: 10px;
            background-color: #B3F5BC;
            border: none;
            border-radius: 5px;
            color: #387a41;
        }
        #btn2:hover{
            background-color: #92c999;
        }
        #btn3{
            padding: 10px;
            background-color: #D1BDFF;
            border: none;
            border-radius: 5px;
            color:  #594488;
        }
        #btn3:hover{
            background-color: #a797cc;
        }
        #btn4{
            padding: 10px;
            background-color: #aee0ee;
            border: none;
            border-radius: 5px;
            color:  #356f7e;
        }
        #btn4:hover{
            background-color: #9dcbd8;
        }

        .column.middle {
            flex: 2; /* Take up twice the space as the side column */
        }

        .column.side {
            flex: 1; /* Take up half the space as the middle column */
            background-color: #F0F2F5;
            padding: 10px;
            border-radius: 10px;
        }

        .fontAwesome {
            font-family: 'Helvetica', FontAwesome, sans-serif;
        }

        #chat-messages {
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background: #fff;
            height: 300px;
            border-radius: 10px;
        }

        .sender-message {
            color: #111B47;
            background-color: #B6BFE2;
            border-radius: 15px;
            margin: 3px;
            padding: 5px;
            width: 30%;
        }

        .receiver-message {
            color: green;
            background-color: #c4e0d1;
            border-radius: 15px;
            margin: 3px;
            padding: 5px;
            width: 30%;
        }

        .title-container {
            background-color: #B6BFE2;
            padding: 18px;
            border-radius: 10px;
        }

        .main-container {
            border-radius: 10px;
        }

        #message-form {
            display: flex;
            align-items: center;
            margin-top: 20px;
            background: transparent;
        }

        #message-input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
            width: 445px;
            border-radius: 10px;
        }

        #btn {
            padding: 13px;
            width: 13%;
            height: 100%;
            border: none;
            background-color: #111B47;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }

        .search-section {
            display: flex; /* Arrange search elements horizontally */
            flex-direction: column; /* Stack elements vertically */
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .search-title {
            text-align: center;
            padding-bottom: 5px;
            font-weight: bold;
        }

        .search-container {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
<div class="row">
    <div class="column middle">
        <div class="main-container">
            <div class="title-container">
                <h2 id="title">Chat with {{ receiver.username }} <i class="fa fa-commenting-o" aria-hidden="true"></i></h2>
            </div>
            <br>
            <div id="chat-messages" 
                hx-get="{% url 'chat' receiver.username %}" 
                hx-trigger="every 4s" 
                hx-swap="innerHTML">
                {% include 'partials/chat_messages_load.html' %}
            </div>
        </div>
        <form method="post" action="{% url 'send_message' username=receiver.username %}" id="message-form">
            {% csrf_token %}
            <textarea id="message-input" name="content" required rows="2" placeholder="Type message"></textarea>
            <button type="send" id="btn">Send</button>
        </form>
    </div>

    <div class="column side" style="height: 200px; width:100%">
        <div class="table-2" >
            <table style="height: 150px">
                <tr class="row-data-2">
                    <td class="data-2">
                        Search in Channel
                    </td>
                </tr>
                <tr class="row-data-2">
                    <td class="data-2">
                        <div class="search-container">
                            <form id="search-form">
                                <i class="fa fa-search" aria-hidden="true"></i>
                                <input type="text" id="search-input" placeholder="Search.." name="search">
                                <br>
                            </form>
                        </div>
                    </td>
                </tr>
                <tr class="row-data-2">
                    <td class="data-2">
                        <!-- Add more elements here -->
                        Attachments
                    </td>
                </tr>
                <tr class="row-data-2">
                    <td class="data-2">
                        <!-- Add more elements here -->
                        <div>
                            <button id="btn1"><i class="fa-solid fa-file-pdf"></i><br>PDF</button>
                            <button id="btn2"><i class="fa fa-video-camera" aria-hidden="true"></i><br>Video</button>
                            <button id="btn3"><i class="fa-solid fa-radio"></i><br>MP3</button>
                            <button id="btn4"><i class="fa-solid fa-image"></i><br>Image</button>
                        </div>

                    </td>
                </tr>
            </table>
            <script>
                window.onload = function () {
                    const chatMessages = document.getElementById("chat-messages");
                    const searchForm = document.getElementById("search-form");
                    const searchInput = document.getElementById("search-input");

                    // Function to filter messages based on search input
                    function filterMessages() {
                        const searchTerm = searchInput.value.toLowerCase();
                        const messages = document.querySelectorAll('.sender-message, .receiver-message');

                        messages.forEach(function (message) {
                            const messageContent = message.textContent.toLowerCase();
                            if (messageContent.includes(searchTerm)) {
                                message.style.display = 'block'; // Show matching messages
                            } else {
                                message.style.display = 'none'; // Hide non-matching messages
                            }
                        });
                    }

                    // Add event listener to search input
                    searchForm.addEventListener("input", filterMessages);

                    // Auto-scroll to the bottom to show the latest message
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                };
            </script>
        </div>
    </div>
</div>

</body>
</html>
{% endblock %}
