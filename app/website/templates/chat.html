{% extends 'base.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Chat with {{ receiver.username }}</title>
    <style>
        #chat-messages {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
        }

        .sender-message {
            color: blue;
        }

        .receiver-message {
            color: green;
        }
    </style>
</head>

<body>
    <h2>Chat with {{ receiver.username }}</h2>
    <div id="chat-messages">
        {% for message in messages %}
            <div class="{% if message.sender == request.user %}sender-message{% else %}receiver-message{% endif %}">
                <p>{{ message.sender.username }}: {{ message.content }}</p>
            </div>
        {% endfor %}
    </div>

    <form method="post" action="{% url 'send_message' username=receiver.username %}" id="message-form">
        {% csrf_token %}
        <textarea id="message-input" name="content" required></textarea>
        <button type="submit">Send</button>
    </form>

    <script>
        window.onload = function () {
        const chatMessages = document.getElementById("chat-messages");
        const messageForm = document.getElementById("message-form");
        const roomName = "{{ receiver.username }}";

        // Auto-scroll to the bottom to show the latest message
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Auto-refresh every 3-5 seconds
        setInterval(function () {
            window.location.reload();
        }, 3000 + Math.floor(Math.random() * 2000));  // Random interval between 3 to 5 seconds

        // Submit the form when Enter key is pressed in the textarea
        document.getElementById("message-input").addEventListener("keydown", function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                messageForm.submit();
            }
        });
    };
        
    </script>
</body>
</html>

{% endblock %}